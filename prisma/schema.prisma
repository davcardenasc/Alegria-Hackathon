// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}


model Application {
  id                  String   @id @default(cuid())
  submittedAt         DateTime @default(now())
  schoolName          String
  coordinatorName     String
  coordinatorEmail    String
  phone               String
  numStudents         Int
  preferredDates      String   // JSON array of selected dates
  comments            String?
  status              ApplicationStatus @default(PENDING)
  starred             Boolean  @default(false)
  reviewedBy          String?
  reviewedAt          DateTime?
  
  // Additional metadata
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  
  // Relations
  reviewer            User?    @relation(fields: [reviewedBy], references: [id])
  
  // Performance indexes for frequently queried fields
  @@index([status])
  @@index([starred])
  @@index([submittedAt])
  @@index([schoolName])
  @@index([coordinatorEmail])
  @@index([reviewedBy])
  @@index([status, starred]) // Composite index for admin dashboard filtering
  @@map("school_applications")
}

model User {
  id            String   @id @default(cuid())
  email         String   @unique
  passwordHash  String
  role          UserRole @default(REVIEWER)
  name          String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  // Relations
  reviewedApplications Application[]
  
  @@map("users")
}


enum ApplicationStatus {
  PENDING
  ACCEPTED
  REJECTED
}

enum UserRole {
  REVIEWER
  ADMINISTRATOR
}
